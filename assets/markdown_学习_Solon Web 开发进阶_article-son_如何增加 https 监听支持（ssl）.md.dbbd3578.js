import{_ as s,v as a,b as n,R as l}from"./chunks/framework.caa0fbaf.js";const F=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"markdown/学习/Solon Web 开发进阶/article-son/如何增加 https 监听支持（ssl）.md","filePath":"markdown/学习/Solon Web 开发进阶/article-son/如何增加 https 监听支持（ssl）.md"}'),p={name:"markdown/学习/Solon Web 开发进阶/article-son/如何增加 https 监听支持（ssl）.md"},o=l(`<p>一般我们是使用 nginx （或者别的反向代理）添加 ssl 监听的。像：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server {</span></span>
<span class="line"><span style="color:#A6ACCD;">  listen        80;</span></span>
<span class="line"><span style="color:#A6ACCD;">  listen       443 ssl;</span></span>
<span class="line"><span style="color:#A6ACCD;">  server_name  solon.noear.org;  </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  ssl_certificate   /data/_ca/solon.noear.org/solon.noear.org_chain.crt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ssl_certificate_key  /data/_ca/solon.noear.org/solon.noear.org_key.key;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ssl_ciphers HIGH:!aNULL:!MD5;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  ssl_session_timeout 5m;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span></span>
<span class="line"><span style="color:#A6ACCD;">  ssl_prefer_server_ciphers on;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">  location / {</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_set_header Host $host;</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    proxy_pass http://127.0.0.1:8086;</span></span>
<span class="line"><span style="color:#A6ACCD;">  }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><p>但某些情况下，我们可以无法使用反向代理，也或者不想用反向代理。这个时候需要我们的应用，直接监听 https 端口。</p><h3 id="_1、添加-ssl-证书配置" tabindex="-1">1、添加 ssl 证书配置 <a class="header-anchor" href="#_1、添加-ssl-证书配置" aria-label="Permalink to &quot;1、添加 ssl 证书配置&quot;">​</a></h3><p>目前支持 ssl 证书配置的已适配 http server 适配有：</p><ul><li>solon.boot.jdkhttp</li><li>solon.boot.jlhttp</li><li>solon.boot.smarthttp</li><li>solon.boot.jetty</li><li>solon.boot.undertow</li></ul><p>请通过工具生成 ssl 证书，目前只支持：<code>jks</code> 和 <code>pfx</code> 两种格式。配置示例：</p><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">server.port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8081</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">server.ssl.keyStore</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/data/_ca/demo.jks</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#或 &quot;demo.pfx&quot;</span></span>
<span class="line"><span style="color:#F07178;">server.ssl.keyPassword</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>以上配置启动后，正确打开为：<code>https://localhost:8081</code> 。</p><h3 id="_2、如果还想要有个-http-端口怎么办-极少有需求会用到" tabindex="-1">2、如果还想要有个 http 端口怎么办？（极少有需求会用到） <a class="header-anchor" href="#_2、如果还想要有个-http-端口怎么办-极少有需求会用到" aria-label="Permalink to &quot;2、如果还想要有个 http 端口怎么办？（极少有需求会用到）&quot;">​</a></h3><p>一个端口只能支持一种协议。配置 ssl 后，8081 端口便是 https 了。想要再有一个 http 端口，需要通过编码方式添加。</p><p>添加一个 8082 的 http 端口为例：(v2.2.18 后支持)</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">SolonMain</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SeverDemo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        Solon</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">SeverDemo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> app </span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onEvent</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">HttpServerConfigure</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> e </span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">//额外再添加一个 http 端口</span></span>
<span class="line"><span style="color:#A6ACCD;">                e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addHttpPort</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">8082</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">});</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3、提醒" tabindex="-1">3、提醒 <a class="header-anchor" href="#_3、提醒" aria-label="Permalink to &quot;3、提醒&quot;">​</a></h3><p>加上证书后，有些别的框架有可能也会读取证书。比如 mysql 链接器，注意 jdbcUrl 的 useSSL 控制。</p>`,15),e=[o];function t(r,c,y,C,i,D){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{F as __pageData,d as default};
