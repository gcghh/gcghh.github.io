import{_ as s,v as a,b as n,R as l}from"./chunks/framework.caa0fbaf.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"markdown/生态/Solon Data Sql/article-son/easy-querysql-solon-plugin.md","filePath":"markdown/生态/Solon Data Sql/article-son/easy-querysql-solon-plugin.md"}'),p={name:"markdown/生态/Solon Data Sql/article-son/easy-querysql-solon-plugin.md"},o=l(`<p><mark>此插件，由社区成员（说都不会话了）贡献</mark></p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">com.easy-query</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">sql-solon-plugin</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">version</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">\${last-version}</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">version</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h4 id="_1、描述" tabindex="-1">1、描述 <a class="header-anchor" href="#_1、描述" aria-label="Permalink to &quot;1、描述&quot;">​</a></h4><p>数据扩展插件，为 Solon Data 提供基于 easy-query 的框架适配，以提供ORM支持。<strong>最新版本，可到 <a href="https://gitee.com/xuejm/easy-query" target="_blank" rel="noreferrer">代码仓库</a> 查看</strong>。</p><h4 id="_2、强调多数据源支持" tabindex="-1">2、强调多数据源支持 <a class="header-anchor" href="#_2、强调多数据源支持" aria-label="Permalink to &quot;2、强调多数据源支持&quot;">​</a></h4><ul><li>强调多数据源的配置。例：demo.db1...，demo.db2...</li><li>强调带 name 的 DataSource Bean</li><li>强调使用 @Db(&quot;name&quot;) 的数据源注解</li><li>全名称 @Db : com.easy.query.solon.annotation.Db</li></ul><p>@Db 可注入类型：</p><table><thead><tr><th>支持类型</th><th>说明</th></tr></thead><tbody><tr><td>EasyQuery</td><td>注入 lambda api风格查询。例：<code>@Db(&quot;db1&quot;) EasyQuery easyQuery</code></td></tr><tr><td>EasyQueryClient</td><td>注入 字符串属性 api风格查询。例：<code>@Db(&quot;db1&quot;) EasyQueryClient easyQueryClient</code>(不推荐没有强类型)</td></tr><tr><td>EasyProxyQuery</td><td>注入 字符串属性 api风格查询。例：<code>@Db(&quot;db1&quot;) EasyProxyQuery easyProxyQuery</code></td></tr></tbody></table><h4 id="_3、数据源配置" tabindex="-1">3、数据源配置 <a class="header-anchor" href="#_3、数据源配置" aria-label="Permalink to &quot;3、数据源配置&quot;">​</a></h4><div class="language-yml"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 配置数据源</span></span>
<span class="line"><span style="color:#F07178;">db1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">jdbcUrl</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">jdbc:mysql://127.0.0.1:3306/easy-query-test?serverTimezone=GMT%2B8&amp;characterEncoding=utf-8&amp;useSSL=false&amp;allowMultiQueries=true&amp;rewriteBatchedStatements=true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">driver-class-name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">com.mysql.cj.jdbc.Driver</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 配置数据源对应的 easy-query 信息（要与 DataSource bean 的名字对上）</span></span>
<span class="line"><span style="color:#F07178;">easy-query.db1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name-conversion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">underlined</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">databsae</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">print-sql</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name-conversion</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">underlined</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">delete-throw</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span></code></pre></div><h4 id="_4、代码应用" tabindex="-1">4、代码应用 <a class="header-anchor" href="#_4、代码应用" aria-label="Permalink to &quot;4、代码应用&quot;">​</a></h4><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Data</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Table</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">t_topic</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Topic</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Column</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">primaryKey</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> id</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Integer</span><span style="color:#A6ACCD;"> stars</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> title</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">LocalDateTime</span><span style="color:#A6ACCD;"> createTime</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Configuration</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">WebConfiguration</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Bean</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">DataSource</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">db1DataSource</span><span style="color:#89DDFF;">(@</span><span style="color:#C792EA;">Inject</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\${db1}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HikariDataSource</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">dataSource</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> dataSource</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     * 配置额外插件,比如自定义逻辑删除,加密策略,拦截器,分片初始化器,值转换,原子追踪更新</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     * @param configuration</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     */</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    @Bean</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    public void db1QueryConfiguration(@Db(&quot;db1&quot;) QueryConfiguration configuration){</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        configuration.applyLogicDeleteStrategy(new MyLogicDelStrategy());</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        configuration.applyEncryptionStrategy(...);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        configuration.applyInterceptor(...);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        configuration.applyShardingInitializer(...);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        configuration.applyValueConverter(...);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        configuration.applyValueUpdateAtomicTrack(...);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     * 添加分表或者分库的路由,分库数据源</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     * @param runtimeContext</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//     */</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    @Bean</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    public void db1QueryRuntimeContext(@Db(&quot;db1&quot;) QueryRuntimeContext runtimeContext){</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        TableRouteManager tableRouteManager = runtimeContext.getTableRouteManager();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        DataSourceRouteManager dataSourceRouteManager = runtimeContext.getDataSourceRouteManager();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        tableRouteManager.addRoute(...);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        dataSourceRouteManager.addRoute(...);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        DataSourceManager dataSourceManager = runtimeContext.getDataSourceManager();</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//        dataSourceManager.addDataSource(key, dataSource, poolSize);</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//    }</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Controller</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Mapping</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestController</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * 注意必须是配置多数据源的其中一个</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Db</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">db1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">EasyQuery</span><span style="color:#A6ACCD;"> easyQuery</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Mapping</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/queryTopic</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#FFCB6B;">method</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> MethodType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GET</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Object</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">queryTopic</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> easyQuery</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">queryable</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Topic</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">where</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">o</span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;">o</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ge</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Topic</span><span style="color:#89DDFF;font-style:italic;">::</span><span style="color:#A6ACCD;">getStars</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toList</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">==&gt;</span><span style="color:#A6ACCD;"> Preparing</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> SELECT \`id\`</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">\`stars\`</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">\`title\`</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">\`create_time\` FROM \`t_topic\` WHERE \`stars\` </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">?</span></span>
<span class="line"><span style="color:#89DDFF;">==&gt;</span><span style="color:#A6ACCD;"> Parameters</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Integer</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;==</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Time</span><span style="color:#A6ACCD;"> Elapsed</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">17</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">ms</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;==</span><span style="color:#A6ACCD;"> Total</span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">101</span></span></code></pre></div><p><strong>具体可参考：</strong></p><p><a href="https://github.com/xuejmnet/easy-query/tree/main/samples/easy-query-solon-web" target="_blank" rel="noreferrer">https://github.com/xuejmnet/easy-query/tree/main/samples/easy-query-solon-web</a></p><p><a href="https://xuejmnet.github.io/easy-query-doc/" target="_blank" rel="noreferrer">https://xuejmnet.github.io/easy-query-doc/</a></p>`,15),e=[o];function t(c,r,y,D,i,C){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{A as __pageData,u as default};
