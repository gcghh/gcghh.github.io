import{_ as s,v as a,b as n,R as l}from"./chunks/framework.caa0fbaf.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"markdown/学习/Solon Cloud 开发/article-son/使用分布式配置服务.md","filePath":"markdown/学习/Solon Cloud 开发/article-son/使用分布式配置服务.md"}'),o={name:"markdown/学习/Solon Cloud 开发/article-son/使用分布式配置服务.md"},p=l(`<p><a href="/article/family-solon-cloud-config">生态 / Solon Cloud Config [传送]</a></p><h3 id="_1、情况简介" tabindex="-1">1、情况简介 <a class="header-anchor" href="#_1、情况简介" aria-label="Permalink to &quot;1、情况简介&quot;">​</a></h3><p>分布式配置服务，也可叫云端配置服务。</p><ul><li>主要通过 CloudConfigService 接口进行适配</li><li>使用 CloudClient.config() 获取适配实例</li><li>一般通过通过配置和 @CloudConfig 注解进行使用</li></ul><p>目前适配有：local, water, consul, nacos, zookeeper, polaris 等</p><h3 id="_2、简单演示" tabindex="-1">2、简单演示 <a class="header-anchor" href="#_2、简单演示" aria-label="Permalink to &quot;2、简单演示&quot;">​</a></h3><h4 id="_2-1、配置" tabindex="-1">2.1、配置 <a class="header-anchor" href="#_2-1、配置" aria-label="Permalink to &quot;2.1、配置&quot;">​</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">solon.app</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">group</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#同时也会做为配置分组</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demoapp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">solon.cloud.water</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">waterapi:9371</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">config</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">load</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demoapp.yml,demo2:test-ds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#默认加载一个配置到应用属性。多个以&#39;,&#39;隔开，跨分组时用{group:key}格式</span></span></code></pre></div><h4 id="_2-2、注入配置" tabindex="-1">2.2、注入配置 <a class="header-anchor" href="#_2-2、注入配置" aria-label="Permalink to &quot;2.2、注入配置&quot;">​</a></h4><p>通过 config.load 加载的配置会直接转到 Solon.cfg()，做为应用配置的一个部分，<mark>且会实时同步配置变更（可能会晚几秒）</mark>。另外，也可使用 @CloudConfig 直接注解配置块</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Configuration</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Config</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//由 config.load 加载的配置，会到应用属性里</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Inject</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">\${demo.user}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">UserModel</span><span style="color:#A6ACCD;"> userModel</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//注入用户名</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">CloudConfig</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo-user-name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> userName</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//注入并转为数据源</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Bean</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">DataSource</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ds</span><span style="color:#89DDFF;">(@</span><span style="color:#C792EA;">CloudConfig</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo-ds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HikariDataSource</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ds</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> ds</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="_2-3、使用接口手动获取-一般不用-太原生了" tabindex="-1">2.3、使用接口手动获取，一般不用（太原生了） <a class="header-anchor" href="#_2-3、使用接口手动获取-一般不用-太原生了" aria-label="Permalink to &quot;2.3、使用接口手动获取，一般不用（太原生了）&quot;">​</a></h4><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">Config</span><span style="color:#A6ACCD;"> cfg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CloudClient</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">config</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">pull</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo-user-name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//使用 {solon.app.group} 组</span></span>
<span class="line"><span style="color:#C792EA;">Config</span><span style="color:#A6ACCD;"> cfg </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> CloudClient</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">config</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">pull</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo-user-name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span></code></pre></div><h4 id="_2-4、通过订阅配置变更" tabindex="-1">2.4、通过订阅配置变更 <a class="header-anchor" href="#_2-4、通过订阅配置变更" aria-label="Permalink to &quot;2.4、通过订阅配置变更&quot;">​</a></h4><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//配置订阅：关注配置的实时更新</span></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">CloudConfig</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demoDb</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestConfigHandler</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">CloudConfigHandler</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">handler</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Config</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">config</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3、会自动更新的配置" tabindex="-1">3、会自动更新的配置 <a class="header-anchor" href="#_3、会自动更新的配置" aria-label="Permalink to &quot;3、会自动更新的配置&quot;">​</a></h3><ul><li>&quot;config.load&quot; 配置的 key</li><li>&quot;@CloudConfig(autoRefreshed = true) &quot; 注入的 key</li><li>&quot;@CloudConfig CloudConfigHandler&quot; 订阅的 key</li></ul><p><strong>代码演示：</strong></p><p><a href="https://gitee.com/noear/solon-examples/tree/main/9.Solon-Cloud" target="_blank" rel="noreferrer">https://gitee.com/noear/solon-examples/tree/main/9.Solon-Cloud</a></p>`,19),e=[p];function t(c,r,D,y,i,C){return a(),n("div",null,e)}const d=s(o,[["render",t]]);export{A as __pageData,d as default};
