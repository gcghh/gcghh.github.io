import{_ as s,v as a,b as n,R as l}from"./chunks/framework.caa0fbaf.js";const i=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"markdown/生态/Solon Queue/article-son/mica-mqtt-server-solon-plugin.md","filePath":"markdown/生态/Solon Queue/article-son/mica-mqtt-server-solon-plugin.md"}'),p={name:"markdown/生态/Solon Queue/article-son/mica-mqtt-server-solon-plugin.md"},o=l(`<p><mark>此系列插件，由社区成员（peigen）贡献</mark></p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">com.gitee.peigenlpy</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">groupId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">mica-mqtt-server-solon-plugin</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">artifactId</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">version</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">2.2.2</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">version</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">dependency</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h3 id="_1、描述" tabindex="-1">1、描述 <a class="header-anchor" href="#_1、描述" aria-label="Permalink to &quot;1、描述&quot;">​</a></h3><p>本插件是完全基于<a href="https://gitee.com/596392912/mica-mqtt" target="_blank" rel="noreferrer">mica-mqtt</a>，是适用于<a href="https://gitee.com/noear/solon" target="_blank" rel="noreferrer">Solon</a>的插件。 开源项目不容易，如果觉得本项目对您的工作还是有帮助的话，请在帮忙在<a href="https://gitee.com/peigenlpy/mica-mqtt-solon-plugin" target="_blank" rel="noreferrer">mica-mqtt-solon-plugin</a>点一下Star(页面右上角)，谢谢。</p><h3 id="_1、-配置项" tabindex="-1">1、 配置项 <a class="header-anchor" href="#_1、-配置项" aria-label="Permalink to &quot;1、 配置项&quot;">​</a></h3><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">mqtt</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">server</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">enabled</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">               </span><span style="color:#676E95;font-style:italic;"># 是否开启服务端，默认：true</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#    ip: 0.0.0.0                # 服务端 ip 默认为空，0.0.0.0，建议不要设置</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1883</span><span style="color:#A6ACCD;">                  </span><span style="color:#676E95;font-style:italic;"># 端口，默认：1883</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Mica-Mqtt-Server</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;"># 名称，默认：Mica-Mqtt-Server</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">buffer-allocator</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HEAP</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;"># 堆内存和堆外内存，默认：堆内存</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">heartbeat-timeout</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">120000</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 心跳超时，单位毫秒，默认: 1000 * 120</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">read-buffer-size</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">8KB</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;"># 接收数据的 buffer size，默认：8k</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">max-bytes-in-message</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">10MB</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 消息解析最大 bytes 长度，默认：10M</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">auth</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">enable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">             </span><span style="color:#676E95;font-style:italic;"># 是否开启 mqtt 认证</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mica</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;"># mqtt 认证用户名</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mica</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;"># mqtt 认证密码</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">debug</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">                 </span><span style="color:#676E95;font-style:italic;"># 如果开启 prometheus 指标收集建议关闭</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">stat-enable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">           </span><span style="color:#676E95;font-style:italic;"># 开启指标收集，debug 和 prometheus 开启时需要打开，默认开启，关闭节省内存</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">web-port</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8083</span><span style="color:#A6ACCD;">              </span><span style="color:#676E95;font-style:italic;"># http、websocket 端口，默认：8083</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">websocket-enable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;">      </span><span style="color:#676E95;font-style:italic;"># 是否开启 websocket，默认： true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http-enable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;"># 是否开启 http api，默认： false</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">http-basic-auth</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">enable</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">             </span><span style="color:#676E95;font-style:italic;"># 是否开启 http basic auth，默认： false</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">username</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mica</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;"># http basic auth 用户名</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">password</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mica</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;"># http basic auth 密码</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ssl</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">                        </span><span style="color:#676E95;font-style:italic;"># mqtt tcp ssl 认证</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">enabled</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;"># 是否开启 ssl 认证，2.1.0 开始支持双向认证</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">keystore-path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;"># 必须参数：ssl keystore 目录，支持 classpath:/ 路径。</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">keystore-pass</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;font-style:italic;"># 必选参数：ssl keystore 密码</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">truststore-path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;"># 可选参数：ssl 双向认证 truststore 目录，支持 classpath:/ 路径。</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">truststore-pass</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;"># 可选参数：ssl 双向认证 truststore 密码</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">client-auth</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">none</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;"># 是否需要客户端认证（双向认证），默认：NONE（不需要）</span></span></code></pre></div><p>注意：<strong>ssl</strong> 存在三种情况</p><table><thead><tr><th>服务端开启ssl</th><th>客户端</th></tr></thead><tbody><tr><td>ClientAuth 为 NONE（不需要客户端验证）</td><td>仅仅需要开启 ssl 即可不用配置证书</td></tr><tr><td>ClientAuth 为 OPTIONAL（与客户端协商）</td><td>需开启 ssl 并且配置 truststore 证书</td></tr><tr><td>ClientAuth 为 REQUIRE (必须的客户端验证)</td><td>需开启 ssl 并且配置 truststore、 keystore证书</td></tr></tbody></table><h3 id="_2、可实现接口-注册成-solon-bean-即可" tabindex="-1">2、可实现接口（注册成 Solon Bean 即可） <a class="header-anchor" href="#_2、可实现接口-注册成-solon-bean-即可" aria-label="Permalink to &quot;2、可实现接口（注册成 Solon Bean 即可）&quot;">​</a></h3><table><thead><tr><th>接口</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>IMqttServerUniqueIdService</td><td>否</td><td>用于 clientId 不唯一时，自定义实现唯一标识，后续接口使用它替代 clientId</td></tr><tr><td>IMqttServerAuthHandler</td><td>是</td><td>用于服务端认证</td></tr><tr><td>IMqttServerSubscribeValidator</td><td>否（建议实现）</td><td>1.1.3 新增，用于对客户端订阅校验</td></tr><tr><td>IMqttServerPublishPermission</td><td>否（建议实现）</td><td>1.2.2 新增，用于对客户端发布权限校验</td></tr><tr><td>IMqttMessageListener</td><td>否（1.3.x为否）</td><td>消息监听</td></tr><tr><td>IMqttConnectStatusListener</td><td>是</td><td>连接状态监听</td></tr><tr><td>IMqttSessionManager</td><td>否</td><td>session 管理</td></tr><tr><td>IMqttSessionListener</td><td>否</td><td>session 监听</td></tr><tr><td>IMqttMessageStore</td><td>集群是，单机否</td><td>遗嘱和保留消息存储</td></tr><tr><td>AbstractMqttMessageDispatcher</td><td>集群是，单机否</td><td>消息转发，（遗嘱、保留消息转发）</td></tr><tr><td>IpStatListener</td><td>否</td><td>t-io ip 状态监听</td></tr><tr><td>IMqttMessageInterceptor</td><td>否</td><td>消息拦截器，1.3.9 新增</td></tr></tbody></table><h3 id="_3、imqttmessagelistener-用于监听客户端上传的消息-使用示例" tabindex="-1">3、IMqttMessageListener (用于监听客户端上传的消息) 使用示例 <a class="header-anchor" href="#_3、imqttmessagelistener-用于监听客户端上传的消息-使用示例" aria-label="Permalink to &quot;3、IMqttMessageListener (用于监听客户端上传的消息) 使用示例&quot;">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Component</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MqttServerMessageListener</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">IMqttMessageListener</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Logger</span><span style="color:#A6ACCD;"> logger </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> LoggerFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getLogger</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MqttServerMessageListener</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onMessage</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">ChannelContext</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">context</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">clientId</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Message</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">message</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">clientId:{} message:{} payload:{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> clientId</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> message</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">String</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">message</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getPayload</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> StandardCharsets</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UTF_8</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_4、自定义配置-可选" tabindex="-1">4、自定义配置（可选） <a class="header-anchor" href="#_4、自定义配置-可选" aria-label="Permalink to &quot;4、自定义配置（可选）&quot;">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Configuration</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MqttServerCustomizerConfiguration</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Bean</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">MqttServerCustomizer</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">mqttServerCustomizer</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MqttServerCustomizer</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">customize</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">MqttServerCreator</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">creator</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">				</span><span style="color:#676E95;font-style:italic;">// 此处可自定义配置 creator，会覆盖 yml 中的配置</span></span>
<span class="line"><span style="color:#A6ACCD;">				System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">----------------MqttServerCustomizer-----------------</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">			</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_5、mqttservertemplate-使用示例" tabindex="-1">5、MqttServerTemplate 使用示例 <a class="header-anchor" href="#_5、mqttservertemplate-使用示例" aria-label="Permalink to &quot;5、MqttServerTemplate 使用示例&quot;">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Component</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ServerService</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Autowired</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">MqttServerTemplate</span><span style="color:#A6ACCD;"> server</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">publish</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">body</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      server</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">publishAll</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/test/123</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> body</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBytes</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">StandardCharsets</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">UTF_8</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true;</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_6、客户端上下线监听" tabindex="-1">6、客户端上下线监听 <a class="header-anchor" href="#_6、客户端上下线监听" aria-label="Permalink to &quot;6、客户端上下线监听&quot;">​</a></h3><p>使用 Solon event 解耦客户端上下线监听，注意：会跟自定义的 <code>IMqttConnectStatusListener</code> 实现冲突，取一即可。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Component</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MqttConnectOfflineListener</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EventListener</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">MqttClientOfflineEvent</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Logger</span><span style="color:#A6ACCD;"> logger </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> LoggerFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getLogger</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MqttConnectOfflineListener</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onEvent</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">MqttClientOfflineEvent</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">mqttClientOfflineEvent</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Throwable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MqttClientOnlineEvent:{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mqttClientOfflineEvent</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Component</span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">MqttConnectOnlineListener</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">EventListener</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">MqttClientOnlineEvent</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">final</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Logger</span><span style="color:#A6ACCD;"> logger </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> LoggerFactory</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getLogger</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">MqttConnectOnlineListener</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Override</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">onEvent</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">MqttClientOnlineEvent</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">mqttClientOnlineEvent</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Throwable</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">		logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MqttClientOnlineEvent:{}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mqttClientOnlineEvent</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div>`,20),t=[o];function e(r,c,y,C,D,A){return a(),n("div",null,t)}const d=s(p,[["render",e]]);export{i as __pageData,d as default};
